<!doctype html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>
<body>
<div class="container">
    <div class="card text-center">
        <div class="card-header">
            Hotspot Dasboard
        </div>
        <div class="card-body">
            <h5 class="card-title">User Ip Address - <span id="localIp"></span></h5>
            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
            <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
        <div class="card-footer text-muted">
            2 days ago
        </div>
    </div>
</div>
<!-- Right -->
{% if messages %}
    <div class='custom_alert'>
        {% for message in messages %}
            {% if message.tags == 'success' %}
                <div class='alert alert-success  alert-dismissible fade show'>{{ message }}
                    <button aria-hidden='true' data-dismiss='alert' class='close' type='button'>
                        ×
                    </button>
                </div>
            {% elif message.tags == 'error' %}
                <div class='alert alert-danger  alert-dismissible fade show'>{{ message }}
                    <button aria-hidden='true' data-dismiss='alert' class='close' type='button'>
                        ×
                    </button>
                </div>
            {% endif %}
        {% endfor %}
    </div>
{% endif %}




<script src="https://code.jquery.com/jquery-3.6.4.min.js"  crossorigin="anonymous"></script>



<script>
    $(document).ready(function () {
         function getLocalIP(callback) {
            const RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
            const pc = new RTCPeerConnection({iceServers: []});

            pc.createDataChannel('');

            pc.createOffer()
                .then(offer => pc.setLocalDescription(offer))
                .catch(error => console.error(error));

            pc.onicecandidate = (event) => {
                if (event.candidate) {
                    callback(event.candidate.candidate.split(' ')[4]);
                }
            };
        }

        // Display the local IP address
        getLocalIP(localIp => {
            document.getElementById('localIp').textContent = localIp || 'Not available';
            sendGetRequestWithData(localIp)
        });


    // Function to send a GET request with data using AJAX

    })


      function sendGetRequestWithData(ipAddress) {
            const data = {
                ip_address: ipAddress
            };

            // Convert the data object to a query string
            const queryString = $.param(data);

            // Include the query string in the URL
            const url = '/hotspot_customer_mac_update/' + '?' + queryString;

            // Use jQuery AJAX to send a GET request
            $.ajax({
                url: url,
                method: 'GET',
                contentType: 'application/json',
                success: function (data) {
                    // Handle the response data here
                    console.log(data);
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

    // Call the function when needed
    // Example usage:
    // sendGetRequestWithData('192.168.1.1');
</script>
</body>
</html>